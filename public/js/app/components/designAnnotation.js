function x(c,d=[],u=null,g=null,r=null){function p(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){let e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function C(t,e){let i,n=function(...h){let a=()=>{i=null,t.apply(this,h)};clearTimeout(i),i=setTimeout(a,e)};return n.cancel=()=>{clearTimeout(i),i=null},n}function f(t,e){let i;return function(...n){i||(t.apply(this,n),i=!0,setTimeout(()=>i=!1,e))}}return{imageUrl:"",imageReady:!0,initFinished:!1,comments:[],isSelecting:!1,isDragging:!1,allCommentsHidden:!1,selectionStart:{x:0,y:0,xPx:null,yPx:null},selectionBox:{x:0,y:0,width:0,height:0},selectedCommentIds:[],showCommentFilter:!1,visibleComments:[],filterMode:!1,touchStartTime:0,longPressTimer:null,touchMoved:!1,isMobile:!1,zoomLevel:1,minZoom:1,maxZoom:9,mainContainerWidth:0,mainContainerHeight:0,innerWrapperWidth:0,innerWrapperHeight:0,panX:0,panY:0,arrowKeyStep:50,callbacks:{onDeleteComment:null,onCommentClick:null},metadata:{},imageNaturalWidth:0,imageNaturalHeight:0,get hasActiveFilter(){return this.allCommentsHidden?!1:this.selectedCommentIds.length<this.comments.length},get canZoomIn(){return this.zoomLevel<this.maxZoom},get canZoomOut(){return this.zoomLevel>this.minZoom},get isZoomed(){return this.zoomLevel>1},get imageDisplayWidth(){return this.innerWrapperWidth||this.imageNaturalWidth*this.zoomLevel},get imageDisplayHeight(){return this.innerWrapperHeight||this.imageNaturalHeight*this.zoomLevel},get currentZoomStep(){let t=this.mainContainerWidth||400,e=window.innerWidth;return e<640?Math.max(100,t*.15):e<768?Math.max(120,t*.18):e<1024?Math.max(150,t*.2):e<1280?Math.max(180,t*.22):Math.max(200,t*.25)},get responsiveMaxZoom(){let t=window.innerWidth;return t<640?4:t<768?5:t<1024?6:8},init(){this.isMobile=this.detectMobileDevice(),this.imageUrl=c,this.comments=d,this.selectedCommentIds=this.comments.map(t=>t.id),this.metadata=r||{},this.throttledUpdateSelection=f(this.updateSelection.bind(this),16),r&&this.isValidMetadata(r)?this.initializeWithMetadata(r):this.initializeWithFallback(u,g),this.setupReactiveWatchers(),this.updateVisibleComments(),this.isMobile?this.$nextTick(()=>{this.initializeHammer()}):this.setupDesktopModeHandlers()},isValidMetadata(t){return t&&t.exists&&!t.hasError&&t.dimensions&&t.container&&t.dimensions.width>0&&t.dimensions.height>0&&t.container.width>0&&t.container.height>0},initializeWithMetadata(t){this.imageNaturalWidth=t.dimensions.width,this.imageNaturalHeight=t.dimensions.height,this.mainContainerWidth=t.container.width,this.mainContainerHeight=t.container.height,this.innerWrapperWidth=t.container.width,this.innerWrapperHeight=t.container.height,this.imageReady=!0,this.initFinished=!0,this.initializeZoomState()},initializeWithFallback(t,e){if(t&&e&&(this.imageNaturalWidth=parseInt(t)||0,this.imageNaturalHeight=parseInt(e)||0,this.imageNaturalWidth>0&&this.imageNaturalHeight>0)){let i=this.calculateOptimalDimensions(this.imageNaturalWidth,this.imageNaturalHeight,this.viewportWidth,this.viewport.height);this.mainContainerWidth=i.width,this.mainContainerHeight=i.height,this.innerWrapperWidth=i.width,this.innerWrapperHeight=i.height,this.imageReady=!0,this.initFinished=!0,this.initializeZoomState();return}this.imageReady=!1,this.initFinished=!1,this.$nextTick(()=>{this.updateImageDimensions(),this.resetZoomState(),setTimeout(()=>this.initFinished=!0,100)})},setupReactiveWatchers(){this.$watch("initFinished",t=>this.imageReady=t),this.$watch("selectedCommentIds",()=>{this.filterMode&&this.updateVisibleComments()})},initializeZoomState(){this.zoomLevel=1,this.panX=0,this.panY=0},calculateOptimalDimensions(t,e,i,n){if(t<=0||e<=0)return{width:i,height:n};let s=t/e,h=i/n,a,o;return s>h?(a=Math.min(t,i),o=Math.round(a/s)):(o=Math.min(e,n),a=Math.round(o*s)),a>i&&(a=i,o=Math.round(i/s)),o>n&&(o=n,a=Math.round(n*s)),{width:a,height:o}},destroy(){this.hammerInstance&&(this.hammerInstance.destroy(),this.hammerInstance=null),this.isMobile||this.removeDesktopModeHandlers(),this.selectionTimeout&&(clearTimeout(this.selectionTimeout),this.selectionTimeout=null),this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressTimer=null),this.updateSelection&&this.updateSelection.cancel&&this.updateSelection.cancel(),this.resetZoomState(),this.comments=[],this.visibleComments=[],this.selectedCommentIds=[],this.callbacks={}},handleEscape(){if(this.showingComment){this.closeComment();return}this.handleClose()},updateVisibleComments(){this.visibleComments=this.filterMode?this.comments.filter(t=>this.selectedCommentIds.includes(t.id)):this.comments.filter(t=>t.text?.trim())},toggleCommentFilter(){this.showCommentFilter=!this.showCommentFilter,this.filterMode=!this.filterMode},toggleAllComments(){this.allCommentsHidden?this.showAllComments():this.hideAllComments()},hideAllComments(){this.selectedCommentIds=[],this.visibleComments=[],this.allCommentsHidden=!0},showAllComments(){this.visibleComments=this.comments,this.selectedCommentIds=this.comments.map(t=>t.id),this.allCommentsHidden=!1},reset(){this.comments=[],this.selectedCommentIds=[],this.activeCommentId=null,this.isSelecting=!1,this.isDragging=!1,this.allCommentsHidden=!1,this.visibleComments=[],this.filterMode=!1,this.showCommentFilter=!1,this.resetZoomState(),this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressTimer=null)},resetZoomState(){this.zoomLevel=1,this.mainContainerWidth=0,this.mainContainerHeight=0,this.innerWrapperWidth=0,this.innerWrapperHeight=0,this.panX=0,this.panY=0},resetPan(){this.panX=0,this.panY=0},hammerInstance:null,initialPinchScale:1,lastPinchScale:1,pinchCenter:{x:0,y:0},gestureSequence:[],currentGesture:null,lastGestureEnd:0,gestureTransitionTime:150,showSelectionMode:!1,selectionTimeout:null,initialImagePan:{x:0,y:0},panStartPoint:{x:0,y:0},isSpacePressed:!1,isShiftPressed:!1,currentMode:"select",showModeIndicator:!1,detectMobileDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0||/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<768},initializeHammer(){!this.isMobile||!window.Hammer||!this.$refs.innerWrapper||(this.hammerInstance=new Hammer.Manager(this.$refs.innerWrapper,{recognizers:[[Hammer.Pinch,{enable:!0}],[Hammer.Pan,{direction:Hammer.DIRECTION_ALL,threshold:5,pointers:1}],[Hammer.Tap,{taps:1,threshold:10,time:250}],[Hammer.Press,{time:400}]]}),this.hammerInstance.get("pinch").recognizeWith("pan"),this.hammerInstance.get("tap").requireFailure("pan"),this.hammerInstance.on("panstart",this.handleHammerPanStart.bind(this)),this.hammerInstance.on("panmove",this.handleHammerPanMove.bind(this)),this.hammerInstance.on("panend",this.handleHammerPanEnd.bind(this)),this.hammerInstance.on("tap",this.handleHammerTap.bind(this)),this.hammerInstance.on("press",this.handleHammerPress.bind(this)),this.hammerInstance.on("pinchstart",this.handleHammerPinchStart.bind(this)),this.hammerInstance.on("pinchmove",this.handleHammerPinchMove.bind(this)),this.hammerInstance.on("pinchend",this.handleHammerPinchEnd.bind(this)))},handleHammerPanStart(t){Date.now()-this.lastGestureEnd<this.gestureTransitionTime||this.currentGesture!=="selecting"&&(this.currentGesture="panning",this.gestureSequence.push("pan"),this.initialImagePan={x:this.panX,y:this.panY},this.panStartPoint={x:t.center.x,y:t.center.y},this.disableSmoothTransitions())},handleHammerPanMove(t){this.currentGesture==="selecting"?this.updateSelectionArea(t):this.currentGesture==="panning"&&this.isZoomed&&this.handleImagePanning(t)},handleHammerPanEnd(t){this.currentGesture==="selecting"?this.completeSelection():this.currentGesture==="panning"&&(this.currentGesture=null,this.lastGestureEnd=Date.now(),this.enableSmoothTransitions())},handleHammerTap(t){if(!(Date.now()-this.lastGestureEnd<this.gestureTransitionTime))if(this.shouldStartSelection(t))this.startSelectionMode(t);else{let i=this.$refs.innerWrapper.getBoundingClientRect();this.handleClick(t.center.x,t.center.y,i)}},handleHammerPress(t){this.startSelectionMode(t,!0)},handleHammerPinchStart(t){this.currentGesture="pinching",this.gestureSequence.push("pinch"),this.cancelSelection(),this.initialPinchScale=t.scale,this.lastPinchScale=this.zoomLevel,this.pinchCenter={x:t.center.x,y:t.center.y},this.disableSmoothTransitions()},handleHammerPinchMove(t){if(this.currentGesture!=="pinching")return;let e=t.scale/this.initialPinchScale,i=Math.max(this.minZoom,Math.min(this.responsiveMaxZoom,this.lastPinchScale*e));this.zoomLevel=i,this.updateImageDimensionsAndCenter()},handleHammerPinchEnd(t){this.currentGesture=null,this.lastGestureEnd=Date.now(),this.enableSmoothTransitions(),this.initialPinchScale=1,this.lastPinchScale=this.zoomLevel},shouldStartSelection(t){let e=this.$refs.innerWrapper.getBoundingClientRect(),i=this.getImageCoordinates(t.center.x,t.center.y);if(this.findCommentAtPoint(i.x,i.y,2.5))return!1;let s=this.gestureSequence.slice(-3),h=s.includes("pinch")||s.includes("pan");return this.isZoomed&&h},startSelectionMode(t,e=!1){this.currentGesture="selecting",this.gestureSequence.push("select"),this.showSelectionMode=!0,navigator.vibrate&&navigator.vibrate(e?[10,50,10]:[10,30,10]);let i=this.$refs.innerWrapper.getBoundingClientRect(),n=this.getImageCoordinates(t.center.x,t.center.y);this.selectionStart={x:n.x,y:n.y,xPx:t.center.x-i.left,yPx:t.center.y-i.top},this.isSelecting=!0,this.isDragging=!0,this.selectionTimeout=setTimeout(()=>{this.currentGesture==="selecting"&&this.completeSelection()},5e3)},handleImagePanning(t){if(!this.isZoomed)return;let e=t.center.x-this.panStartPoint.x,i=t.center.y-this.panStartPoint.y;this.updatePanPosition(this.initialImagePan.x+e,this.initialImagePan.y+i)},updateSelectionArea(t){let e=this.$refs.innerWrapper.getBoundingClientRect(),i=this.getImageCoordinates(t.center.x,t.center.y);this.selectionBox={x:Math.min(this.selectionStart.x,i.x),y:Math.min(this.selectionStart.y,i.y),width:Math.abs(i.x-this.selectionStart.x),height:Math.abs(i.y-this.selectionStart.y)}},updatePanPosition(t,e){let i=Math.max(0,(this.innerWrapperWidth-this.mainContainerWidth)/2),n=Math.max(0,(this.innerWrapperHeight-this.mainContainerHeight)/2);this.panX=Math.max(-i,Math.min(i,t)),this.panY=Math.max(-n,Math.min(n,e))},handleDesktopPanning(t){if(!this.isZoomed)return;let e=t.clientX-this.panStartPoint.x,i=t.clientY-this.panStartPoint.y;this.updatePanPosition(this.initialImagePan.x+e,this.initialImagePan.y+i)},cancelSelection(){this.isSelecting=!1,this.isDragging=!1,this.showSelectionMode=!1,this.currentGesture=null,this.resetSelectionState(),this.selectionTimeout&&(clearTimeout(this.selectionTimeout),this.selectionTimeout=null)},completeSelection(){this.selectionBox.width>1&&this.selectionBox.height>1&&this.createAreaComment(),this.cancelSelection()},setupDesktopModeHandlers(){this.handleKeyDown=this.handleDesktopKeyDown.bind(this),this.handleKeyUp=this.handleDesktopKeyUp.bind(this),window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("keyup",this.handleKeyUp)},removeDesktopModeHandlers(){this.handleKeyDown&&(window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("keyup",this.handleKeyUp))},handleDesktopKeyDown(t){t.code==="Space"&&!this.isSpacePressed&&(t.preventDefault(),this.isSpacePressed=!0,this.currentMode="pan",this.showModeIndicator=!0,setTimeout(()=>{this.isDragging||(this.showModeIndicator=!1)},2e3)),(t.code==="ShiftLeft"||t.code==="ShiftRight")&&(this.isShiftPressed=!0,this.currentMode="select",this.showModeIndicator=!0,setTimeout(()=>{this.isDragging||(this.showModeIndicator=!1)},2e3))},handleDesktopKeyUp(t){t.code==="Space"&&(this.isSpacePressed=!1,this.isDragging||(this.currentMode="select",this.showModeIndicator=!1)),(t.code==="ShiftLeft"||t.code==="ShiftRight")&&(this.isShiftPressed=!1,this.isDragging||(this.currentMode="select",this.showModeIndicator=!1))},getDesktopMode(){return this.isZoomed?this.isSpacePressed?"pan":this.isShiftPressed?"select":this.currentMode:"select"},handleClose(){if(this.showCommentFilter){this.showCommentFilter=!1,this.filterMode=!1;return}},handleBackdropClick(t){t.target===t.currentTarget&&this.handleClose()},startSelection(t){if(t.button!==0)return;this.disableSmoothTransitions();let e=this.$refs.innerWrapper.getBoundingClientRect(),i=t.clientX-e.left,n=t.clientY-e.top;if(!this.isMobile&&this.getDesktopMode()==="pan"&&this.isZoomed){this.currentGesture="panning",this.initialImagePan={x:this.panX,y:this.panY},this.panStartPoint={x:t.clientX,y:t.clientY},this.isDragging=!0;return}let s=this.getImageCoordinates(t.clientX,t.clientY);this.selectionStart={x:s.x,y:s.y,xPx:i,yPx:n},this.isDragging=!0,this.isSelecting=!1},updateSelection(t){if(!this.isDragging)return;if(!this.isMobile&&this.currentGesture==="panning"){this.handleDesktopPanning(t);return}if(!this.selectionStart.xPx)return;let e=this.$refs.innerWrapper.getBoundingClientRect(),i=Math.max(0,Math.min(t.clientX-e.left,e.width)),n=Math.max(0,Math.min(t.clientY-e.top,e.height));if(Math.sqrt(Math.pow(i-this.selectionStart.xPx,2)+Math.pow(n-this.selectionStart.yPx,2))>(this.isMobile?8:5)&&(this.isSelecting=!0),!this.isSelecting)return;let h=this.getImageCoordinates(t.clientX,t.clientY);this.selectionBox={x:Math.min(this.selectionStart.x,h.x),y:Math.min(this.selectionStart.y,h.y),width:Math.abs(h.x-this.selectionStart.x),height:Math.abs(h.y-this.selectionStart.y)}},endSelection(t){if(!this.isDragging)return;let e=this.$refs.innerWrapper.getBoundingClientRect(),i=t.clientX-e.left,n=t.clientY-e.top;if(!this.isMobile&&this.currentGesture==="panning"){this.currentGesture=null,this.isDragging=!1,this.enableSmoothTransitions(),this.showModeIndicator=!1;return}this.isDragging=!1,this.enableSmoothTransitions(),this.isSelecting&&this.selectionBox.width>1&&this.selectionBox.height>1?this.createAreaComment():i>=0&&i<=e.width&&n>=0&&n<=e.height&&this.handleClick(t.clientX,t.clientY,e),this.resetSelectionState(),this.showModeIndicator=!1},handleTouchStart(t){if(this.isMobile&&this.hammerInstance)return;this.disableSmoothTransitions();let e=t.touches[0],i=this.$refs.innerWrapper.getBoundingClientRect(),n=e.clientX-i.left,s=e.clientY-i.top;this.touchStartTime=Date.now(),this.touchMoved=!1;let h=this.getImageCoordinates(e.clientX,e.clientY);this.selectionStart={x:h.x,y:h.y,xPx:n,yPx:s},this.isDragging=!0,this.isSelecting=!1,this.longPressTimer=setTimeout(()=>{!this.touchMoved&&this.isDragging&&(navigator.vibrate&&navigator.vibrate([10,50,10]),this.isSelecting=!0)},300)},handleTouchMove(t){if(this.isMobile&&this.hammerInstance||!this.isDragging)return;let e=t.touches[0],i=this.$refs.innerWrapper.getBoundingClientRect(),n=Math.max(0,Math.min(e.clientX-i.left,i.width)),s=Math.max(0,Math.min(e.clientY-i.top,i.height));if(Math.sqrt(Math.pow(n-this.selectionStart.xPx,2)+Math.pow(s-this.selectionStart.yPx,2))>12&&(this.touchMoved=!0,this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressTimer=null),this.isSelecting=!0),!this.isSelecting)return;let a=this.getImageCoordinates(e.clientX,e.clientY);this.selectionBox={x:Math.min(this.selectionStart.x,a.x),y:Math.min(this.selectionStart.y,a.y),width:Math.abs(a.x-this.selectionStart.x),height:Math.abs(a.y-this.selectionStart.y)}},handleTouchEnd(t){if(this.isMobile&&this.hammerInstance||!this.isDragging)return;this.longPressTimer&&(clearTimeout(this.longPressTimer),this.longPressTimer=null),this.enableSmoothTransitions();let e=this.$refs.innerWrapper.getBoundingClientRect(),i=Date.now()-this.touchStartTime;if(this.isSelecting&&this.selectionBox.width>1&&this.selectionBox.height>1)this.createAreaComment();else if(!this.touchMoved&&i<300){let n=t.changedTouches[0];this.handleClick(n.clientX,n.clientY,e)}this.isDragging=!1,this.resetSelectionState()},handleClick(t,e,i){if(!this.isZoomed){let o=this.getImageCoordinates(t,e),m=this.isMobile?2.5:1.5,l=this.findCommentAtPoint(o.x,o.y,m);if(l)return this.selectComment(l)}let n=this.getImageCoordinates(t,e),s=this.isMobile?3:2,h=s/2,a={x:Math.max(0,Math.min(100-s,n.x-h)),y:Math.max(0,Math.min(100-s,n.y-h)),width:s,height:s,type:"point",imageUrl:this.imageUrl,isMobile:this.isMobile,zoomLevel:this.zoomLevel};this.dispatchCommentEvent(a)},createAreaComment(){let t={x:Math.max(0,Math.min(100,this.selectionBox.x)),y:Math.max(0,Math.min(100,this.selectionBox.y)),width:Math.min(this.selectionBox.width,100-this.selectionBox.x),height:Math.min(this.selectionBox.height,100-this.selectionBox.y),type:"area",imageUrl:this.imageUrl,isMobile:this.isMobile,zoomLevel:this.zoomLevel};this.dispatchCommentEvent(t)},dispatchCommentEvent(t){window.dispatchEvent(new CustomEvent("open-comment-modal",{detail:t,bubbles:!0}))},resetSelectionState(){this.selectionStart={x:0,y:0,xPx:null,yPx:null},this.selectionBox={x:0,y:0,width:0,height:0},this.isSelecting=!1},findCommentAtPoint(t,e,i=0){return this.visibleComments.find(n=>{let s=n.x-i,h=n.x+n.width+i,a=n.y-i,o=n.y+n.height+i;return t>=s&&t<=h&&e>=a&&e<=o})},selectComment(t){console.log("Comment selected:",t),this.callbacks.onCommentClick&&this.callbacks.onCommentClick(t)},setCallbacks(t={}){let e=["onDeleteComment","onCommentClick"];Object.keys(t).forEach(i=>{e.includes(i)&&typeof t[i]=="function"&&(this.callbacks[i]=t[i])})},getComments(){return this.comments},addComment(t){let e={id:t.id||p(),...t};this.comments.find(i=>i.id===e.id)||(this.comments.push(e),this.selectedCommentIds.includes(e.id)||this.selectedCommentIds.push(e.id),this.updateVisibleComments())},async removeComment(t){try{let e=[...this.comments],i=[...this.selectedCommentIds];this.comments=this.comments.filter(n=>n.id!==t),this.selectedCommentIds=this.selectedCommentIds.filter(n=>n!==t),this.updateVisibleComments(),this.callbacks.onDeleteComment&&await this.callbacks.onDeleteComment(t)}catch(e){console.error("Error deleting comment:",e),this.comments=originalComments,this.selectedCommentIds=originalSelectedIds,this.updateVisibleComments(),alert("Failed to delete comment. Please try again.")}},zoomIn(t=1.2){this.enableSmoothTransitions();let e=Math.min(this.zoomLevel*t,this.maxZoom);this.setZoom(e)},zoomOut(t=1.2){this.enableSmoothTransitions();let e=Math.max(this.zoomLevel/t,this.minZoom);this.setZoom(e)},resetZoom(){this.setZoom(1),this.resetPan()},setZoom(t){this.zoomLevel=t,this.updateImageDimensionsAndCenter()},centerImage(){if(this.innerWrapperWidth<=this.mainContainerWidth)this.panX=0;else{let t=Math.max(0,(this.innerWrapperWidth-this.mainContainerWidth)/2);this.panX=Math.max(-t,Math.min(t,this.panX))}if(this.innerWrapperHeight<=this.mainContainerHeight)this.panY=0;else{let t=Math.max(0,(this.innerWrapperHeight-this.mainContainerHeight)/2);this.panY=Math.max(-t,Math.min(t,this.panY))}},enableSmoothTransitions(){this.$refs.innerWrapper&&(this.$refs.innerWrapper.style.transition="transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94), width 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94), height 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94)")},disableSmoothTransitions(){this.$refs.innerWrapper&&(this.$refs.innerWrapper.style.transition="none")},updateImageDimensionsAndCenter(){if(this.mainContainerWidth===0||this.mainContainerHeight===0){this.updateImageDimensions();return}this.updateInnerWrapperDimensions(),this.constrainPanPosition()},constrainPanPosition(){let t=Math.max(0,(this.innerWrapperWidth-this.mainContainerWidth)/2),e=Math.max(0,(this.innerWrapperHeight-this.mainContainerHeight)/2);this.innerWrapperWidth<=this.mainContainerWidth?this.panX=0:this.panX=Math.max(-t,Math.min(t,this.panX)),this.innerWrapperHeight<=this.mainContainerHeight?this.panY=0:this.panY=Math.max(-e,Math.min(e,this.panY))},updateImageDimensions(){this.$nextTick(()=>{let t=this.$refs.scrollContainer,e=this.$refs.mainContainer,i=this.$refs.innerWrapper,n=this.$refs.image;if(!(!t||!e||!i)){if(this.mainContainerWidth===0){this.calculateContainerDimensionsFromViewport(t,n);return}this.updateInnerWrapperDimensions()}})},calculateContainerDimensionsFromViewport(t,e){let i=t.clientWidth,n=t.clientHeight,s=0,h=0;this.imageNaturalWidth>0&&this.imageNaturalHeight>0?(s=this.imageNaturalWidth,h=this.imageNaturalHeight):e&&e.naturalWidth>0&&e.naturalHeight>0?(s=e.naturalWidth,h=e.naturalHeight,this.imageNaturalWidth=s,this.imageNaturalHeight=h):(i/n>4/3?(s=Math.round(n*4/3),h=n):(s=i,h=Math.round(i*3/4)),this.imageNaturalWidth=s,this.imageNaturalHeight=h);let a=this.calculateOptimalDimensions(s,h,i,n);this.mainContainerWidth=a.width,this.mainContainerHeight=a.height,this.innerWrapperWidth=a.width,this.innerWrapperHeight=a.height},updateInnerWrapperDimensions(){if(this.mainContainerWidth===0||this.mainContainerHeight===0)return;let e=1+(this.zoomLevel-1)*this.currentZoomStep/Math.max(this.mainContainerWidth,this.mainContainerHeight);this.innerWrapperWidth=Math.round(this.mainContainerWidth*e),this.innerWrapperHeight=Math.round(this.mainContainerHeight*e)},get currentMainContainerWidth(){return this.mainContainerWidth||"auto"},get currentMainContainerHeight(){return this.mainContainerHeight||"auto"},get currentInnerWrapperWidth(){return this.innerWrapperWidth||this.mainContainerWidth||0},get currentInnerWrapperHeight(){return this.innerWrapperHeight||this.mainContainerHeight||0},handleWheel(t){t.preventDefault();let e=t.deltaY,i=1.1;e<0&&this.canZoomIn?this.zoomIn(i):e>0&&this.canZoomOut&&this.zoomOut(i)},handleArrowKeys(t){if(!this.isZoomed)return;t.preventDefault();let e=this.arrowKeyStep,i=Math.max(0,(this.innerWrapperWidth-this.mainContainerWidth)/2),n=Math.max(0,(this.innerWrapperHeight-this.mainContainerHeight)/2);switch(t.key){case"ArrowUp":this.panY=Math.min(n,this.panY+e);break;case"ArrowDown":this.panY=Math.max(-n,this.panY-e);break;case"ArrowLeft":this.panX=Math.min(i,this.panX+e);break;case"ArrowRight":this.panX=Math.max(-i,this.panX-e);break}},getImageCoordinates(t,e){let i=this.$refs.innerWrapper,n=this.$refs.image;if(!i||!n)return{x:0,y:0};let s=i.getBoundingClientRect(),h=n.getBoundingClientRect(),a=t-h.left,o=e-h.top,m=a/h.width*100,l=o/h.height*100;return{x:Math.max(0,Math.min(100,m)),y:Math.max(0,Math.min(100,l))}},onImageLoad(){let t=this.$refs.image;t&&t.naturalWidth>0&&t.naturalHeight>0&&(!this.imageNaturalWidth||!this.imageNaturalHeight)&&(this.imageNaturalWidth=t.naturalWidth,this.imageNaturalHeight=t.naturalHeight,this.mainContainerWidth===0&&this.$nextTick(()=>{this.updateImageDimensions()})),(!this.imageReady||!this.initFinished)&&(this.imageReady=!0,this.initFinished=!0)}}}export{x as default};
